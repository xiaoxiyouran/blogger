
<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

	<title>链接</title>
	<meta name="keywords" content="xiaoxiyouran" />
	<meta name="description" content="xiaoxiyouran's Docs" />
	<link href="../../../../packages/css/bootstrap.min.css" rel="stylesheet" />
	<link href="../../../../packages/css/style.css" rel="stylesheet" />
	<link href="../../../../packages/css/monokai_sublime.min.css" rel="stylesheet">
	
	<!-- 右上角的侧边导航栏 -->
	<link rel="stylesheet" href="../../../../packages/hock_side_bar/css/sidebar.css"> <!--初始化文件-->
	<script src="../../../../packages/hock_side_bar/js/sidebar.js"></script> <!--rem适配js-->
	
	<!--
	<link href="<?php echo $base_url?>/css/bootstrap-theme.min.css" rel="stylesheet" />
	-->
	
	<!-- To generate the side tree of the document itself. -->
  <link rel="stylesheet" href="../../../../packages/generate_header_sidebar/css/zTreeStyle/zTreeStyle.css" type="text/css">
  <style>
  body {
  background-color: white;
  margin:0; padding:0;
  // text-align: center;
  overflow: scroll;
  }
  div, p, table, th, td {
    list-style:none;
    margin:8px; padding:0;
    color:#333; font-size:12px;
   Font-family: Helvetica, Tahoma, Arial, STXihei, “华文细黑”, “Microsoft YaHei”, “微软雅黑”, SimSun, “宋体”, Heiti, “黑体”, sans-serif;
  }
  
 // table{
 //   border-collapse:collapse;
 // }

  //table, td, th{
  //  border:1px solid black;   
  //}
  
  .ztree li a.curSelectedNode {
    padding-top: 0px;
    background-color: #FFE6B0;
    color: black;
    height: 16px;
    border: 1px #FFB951 solid;
    opacity: 0.8;
  }
  .ztree{
    overflow: auto;
    height:100%;
    min-height: 200px;
    top: 0px;
  }
  </style>

<!--
  For Latex formula
-->
<!--
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {inlineMath: [["$","$"],["\(","\)"]]}
  });
</script>
-->
 <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {inlineMath: [["$","$"]]}
  });
</script>
 <script type="text/javascript" src="../../../../packages/MathJax/MathJax.js?config=TeX-AMS_HTML-full"></script>

<!-- mermaid 画图 -->
 <link rel="stylesheet" href="../../../../packages/mermaid-7.0.0/dist/mermaid.forest.css"/>
 <script src="../../../../packages/mermaid-7.0.0/dist/mermaid.js"></script>
 <script src="../../../../packages/mermaid-7.0.0/dist/dist/mermaid.full.js"></script>
 <!-- <scrpt src="../../../../packages/mermaid-7.0.0/node_modules/d3/d3.js"></scrpt> -->
 <!-- <script>mermaid.initialize({startOnLoad:true});</script>  -->
 <script>
	//browserify --entry src/mermaid.js -u d3 -o ./dist/mermaid.brow.slim.js
			var mermaid_config = {
					startOnLoad:true
			}
			mermaid.ganttConfig = {
					titleTopMargin:25,
					barHeight:20,
					barGap:4,
					topPadding:50,
					leftPadding:75,
					gridLineStartPadding:35,
					fontSize:11,
					numberSectionStyles:3,
					axisFormatter: [
							// Within a day
							["%I:%M", function (d) {
									return d.getHours();
							}],
							// Monday a week
							["w. %U", function (d) {
									return d.getDay() == 1;
							}],
							// Day within a week (not monday)
							["%a %d", function (d) {
									return d.getDay() && d.getDate() != 1;
							}],
							// within a month
							["%b %d", function (d) {
									return d.getDate() != 1;
							}],
							// Month
							["%m-%y", function (d) {
									return d.getMonth();
							}]
					]
			};
	</script>

</head>
<body>
<!-- 右上角的悬浮 sidebar  -->
<div id="mySidenav" class="sidenav">
  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
   <a href="#"> 目录 </a>
   <iframe id="ha" src=" ../../global_sidebar.html" name='left' frameborder="0" scrolling="auto" width="400"  height="100%">
    您的浏览器不支持iframe，请升级
   </iframe>  
</div>

<TABLE border=0 height=600px align=left>
  <TR>
    <TD width=260px align=left valign=top style="BORDER-RIGHT: #999999 1px dashed">
      <ul id="tree" class="ztree">
        
      </ul>
    </TD>
    <TD width=770px align=left valign=top>

<!---------------------------------------------------------------------------------------------------------------------------->
<div class="container">
<span style="font-size:20px;cursor:pointer;z-index: 9999; position: fixed; right: 0px; top: 0px;" onclick="openNav()">&#9776; 目录</span>
 
<h1 id="_1">链接</h1>
<hr />
<blockquote>
<p>牛客OJ：<a href="http://www.nowcoder.com/practice/7a0da8fc483247ff8800059e12d7caf1?tpId=13&amp;tqId=11200&amp;rp=2&amp;ru=%2Fta%2Fcoding-interviews&amp;qru=%2Fta%2Fcoding-interviews%2Fquestion-ranking">求1+2+3+...+n</a></p>
<p>九度OJ：http://ac.jobdu.com/problem.php?pid=1506</p>
<p>GitHub代码： <a href="https://github.com/gatieme/CodingInterviews/tree/master/046-求1+2+3+...+n">046-求1+2+3+...+n</a></p>
<p>CSDN题解：<a href="http://blog.csdn.net/gatieme/article/details/51485713">剑指Offer--046-求1+2+3+...+n</a></p>
</blockquote>
<table style='border: 1px solid black; border-collapse:collapse;  border-spacing:0;'>
<thead>
<tr>
<th style='border: 1px solid black; border-collapse:collapse;  border-spacing:0;'>牛客OJ</th>
<th align="center">九度OJ</th>
<th align="right">CSDN题解</th>
<th align="right">GitHub代码</th>
</tr>
</thead>
<tbody>
<tr>
<td style='border: 1px solid black; border-collapse:collapse;  border-spacing:0;'><a href="http://www.nowcoder.com/practice/7a0da8fc483247ff8800059e12d7caf1?tpId=13&amp;tqId=11200&amp;rp=2&amp;ru=%2Fta%2Fcoding-interviews&amp;qru=%2Fta%2Fcoding-interviews%2Fquestion-ranking">046-求1+2+3+...+n</a></td>
<td align="center"><a href="http://ac.jobdu.com/problem.php?pid=1506">1506-求1+2+3+...+n</a></td>
<td align="right"><a href="http://blog.csdn.net/gatieme/article/details/51485713">剑指Offer--046-求1+2+3+...+n</a></td>
<td align="right"><a href="https://github.com/gatieme/CodingInterviews/tree/master/046-求1+2+3+...+n">046-求1+2+3+...+n</a></td>
</tr>
</tbody>
</table>
<h1 id="_2">题意</h1>
<hr />
<p><strong>题目描述</strong></p>
<blockquote>
<p>求1+2+3+...+n，</p>
</blockquote>
<p>要求不能使用乘除法、for、while、if、else、switch、case等关键字及条件判断语句（A?B:C）。</p>
<p><strong>样例输入</strong></p>
<blockquote>
<p>3</p>
<p>5</p>
</blockquote>
<p><strong>样例输出</strong></p>
<blockquote>
<p>6</p>
<p>15</p>
</blockquote>
<h1 id="_3">递归+短路判断终止</h1>
<hr />
<p>计算1+2+3+...+n, 可以认为是一个<strong>递归</strong>的过程, 这点很容易理解</p>
<p>但是怎么不用分支判断来保证递归的终止呢</p>
<p>还记得我们的调试语句么</p>
<pre><code class="cpp">#ifdef __tmain
	#define debug cout
#else
	#define debug 0 &amp;&amp; cout
#endif // __tmain
</code></pre>

<p>如果不希望使用调试模式，则通过短路运算<code>0 &amp;&amp; cout</code>使条件为假值, 从而不执行输出语句，那么我们也可以通过短路来实现循环终止, </p>
<ul>
<li>从n开始递减进程递归的相加运算</li>
<li>当递归至0时使递归短路即可</li>
</ul>
<p>代码如下</p>
<pre><code class="cpp">class Solution
{
public:
	int SumRecursion(int n)
	{
		int ans = n;
		//debug &lt;&lt;n &lt;&lt;endl;
		n &amp;&amp; (ans += SumRecursion(n - 1));
		return ans;
	}
};
</code></pre>

<p>其实也可以用下面的语句</p>
<blockquote>
<p>ans &amp;&amp; (ans += Sum_Solution(n - 1));</p>
</blockquote>
<p>ans每次均被初始化为n, 因此用n或者ans进行短路运算都可以，其本质就是通过n进行短路运算判断</p>
<h1 id="123nnn12">位运算计算$1+2+3+...+n=n(n+1)/2$</h1>
<hr />
<p>我们其实知道，等差数列求和的问题</p>
<p>$1+2+3+...+n=\frac{n(n+1)}{2}$</p>
<p>但是$\frac{n(n+1)}{2}$是一个乘除的运算, 本题限制使用乘除，因此我们得另寻它法</p>
<p>我们知道a*b运算在计算机内部其实是通过移位和加法来完成的</p>
<pre><code class="c">int Multi(int a, int b)
{
	int res = 0;
	while(a != 0)
	{
		if((a &amp; 1) != 0)
		{
			res += b;
		}
		a &gt;&gt;= 1;
		b &lt;&lt;= 1;

	}

	return res;
}
</code></pre>

<p>那么我们的结果就是</p>
<blockquote>
<p>Multi(n, n + 1) &gt;&gt;1
但是我们的乘法函数中仍然有循环和判断, 因此我们需要进一步优化, </p>
</blockquote>
<p>还是上面的策略，
<em>    循环用递归来代替
</em>    分支用短路运算来代替</p>
<p>那么我们的乘法运算就成为</p>
<pre><code class="c">int MultiRecursion(int a, int b)
{
	static int res = 0;
	a &amp;&amp; MultiRecursion(a &gt;&gt; 1, b &lt;&lt; 1);    //  递归的进行运算
	(a &amp; 1) &amp;&amp; (res += b);                  //  短路

	return res;
}
</code></pre>

<p>最后完成代码如下</p>
<pre><code class="c">class Solution
{
public:
	int res;
	int Sum_Solution(int n)
	{
		res = 0;
		return (MultiRecursion(n, n + 1) &gt;&gt; 1);
	}

	int MultiRecursion(int a, int b)
	{
		a &amp;&amp; MultiRecursion(a &gt;&gt; 1, b &lt;&lt; 1);    //  递归的进行运算

		(a &amp; 1) &amp;&amp; (res += b);                  //  短路


		return res;
	}

};
</code></pre>

<p>网上还有类似的写法，如下,</p>
<pre><code class="cpp"> bool f(int k,int n,int &amp;ans,int s,int t)
	{
		ans = ans + ((t&lt;&lt;s)&amp;(~(p+(n&amp;1))));
		return k&lt;32 &amp;&amp;  f(k+1,n&gt;&gt;1,ans,s+1,t);
	}
	int Sum_Solution(int n)
	{
		int t = n+1;
		int k = 0;
		int ans = 0;
		int s = 0;
		f(k,n,ans,s,t);
		ans&gt;&gt;=1;
		return ans;
	}
};
</code></pre>

<h1 id="_4">利用构造函数求解</h1>
<hr />
<p>循环操作也只是累加了N次, 重复的让相同的代码执行了N次</p>
<p>还记得我们C++里面类对象里面的静态计数器么的设计么, 静态的count可以在构造函数中进行累加, 从而维护出类对象的个数</p>
<p>那么我们采用相同的思路, 在类的构造函数里面进行计数器的累加和求和操作, 构造出N个对象即可完成所需操作</p>
<pre><code class="c">class Temp
{
public :
	Temp( )
	{
		++N;
		Sum += N;
	}

	static void Reset( )
	{
		N = 0;
		Sum = 0;
	}

	static unsigned int GetSum( )
	{
		return Sum;
	}

private :
	static unsigned int N;
	static unsigned int Sum;
};

unsigned int Temp::N = 0;
unsigned int Temp::Sum = 0;

class Solution
{
public:
	int res;
	int Sum_Solution(int n)
	{
		Temp::Reset( );

		Temp *a = new Temp[n];
		delete[] a;
		a = NULL;

		return Temp::GetSum( );
	}
};
</code></pre>

<h1 id="_5">利用虚函数求解</h1>
<hr />
<p>我们同样可以围绕递归做文章, 既然不能在一个函数中通过分支判断是不是终止递归</p>
<p>我们可以<font color = 0x00ffff>定义两个函数, 一个函数充当递归函数的角色，另一个函数处理终止递归的情况, </font></p>
<p>而我们需要在两个函数中二选一, 从二选一我们自然的想到了布尔变量, 比如值为true的时候调用第一个, 值为false的时候, 调用第二个函数, </p>
<p>那么我们怎么把一个值n转换为布尔类型呢, 如果对n连续做两次反运算, 即!!n, 那么非零的n转换为true, 0转换为false</p>
<p>代码如下</p>
<pre><code class="cpp">class base;
base *parray[2];

class base{
public:
	virtual unsigned int sum(unsigned int n)
	{
		//  递归的终止
		return 0;
	}
};

class derive :public base{
public:
	virtual unsigned int sum(unsigned int n)
	{
		//  !!n两次非运算, 从而将n转换为bool类型, 来选择函数
		//  sum(n) = sum(n - 1) + n 则是递归公式
		return parray[!!n]-&gt;sum(n - 1) + n;
	}
};


class Solution
{
public:
	int Sum_Solution(int n)
	{

		base a;
		derive b;

		parray[0] = &amp;a;
		parray[1] = &amp;b;

		return parray[1]-&gt;sum(n);
	}
};


int main(){

	Solution s;

	cout&lt;&lt;s.Sum_Solution(10);

	return 0;
}
</code></pre>

<h1 id="_6">利用函数指针求解</h1>
<hr />
<p>前面那个例子我们通过了C++的虚函数和多态的特性来实现了函数的选择, 但是其实我们用函数指针也可以实现选择函数</p>
<pre><code class="c">typedef int (*func)(int);

// 递归的终止函数
int Teminator(int n)
{
	return 0;
}

//  递归函数, 选择函数进行递归
int Recursion(int n)
{
	static func pf[2] =
	{
		Teminator,
		Recursion,
	};

	return n + pf[!!n](n - 1);
}


class Solution
{
public :
	int Sum_Solution(int n)
	{
		return Recursion(n);
	}

};
</code></pre>

<h1 id="_7">利用模板类型求解</h1>
<hr />
<p>利用编译器帮助完成类似于递归的运算</p>
<pre><code class="cpp">#include &lt;iostream&gt;

using namespace std;

template &lt; unsigned int n&gt;
struct Sum
{
	enum Value
	{
		N = Sum&lt; n - 1 &gt;::N + n
	};
};

template &lt;&gt;
struct Sum&lt;1&gt;
{
	enum Value
	{
		N = 1
	};
};


int main( )
{

	cout &lt;&lt;Sum&lt;100&gt;::N &lt;&lt;endl;

	return 0;
}
</code></pre>

<p>Sum&lt;100&gt;::N就是1+2++...+100的结果, 当编译器看到Sum&lt;100&gt;::N时, 就会为模板类Sum以参数100生成对象, 而由于这个类的定义是递归的, 因此编译器会一直递归的操作, 直至参数为1, 递归结束。</p>
<p>缺陷</p>
<ol>
<li>
<p>由于这个过程是由编译器在编译阶段完成的, 因此要求n必须是一个编译期间就能确定的常量, 不能动态定义</p>
</li>
<li>
<p>编译器对递归编译代码的递归深度是由限制的, 因此要去n不能太大。</p>
</li>
</ol>
<h1 id="_8">数组指针+求和公式</h1>
<hr />
<blockquote>
<p>感谢<a href="https://github.com/aheadlead">网友aheadlead</a>提供了方法,</p>
<p>参见https://github.com/gatieme/CodingInterviews/commit/82641aa505c99983339a7fb64fc57df6d30bbaef</p>
</blockquote>
<p>使用经典的求和公式。但是使用数组指针绕开了不能使用乘法的问题。</p>
<pre><code class="c">printf(&quot;%d\n&quot;, ( (int)( &amp;( (uint8_t (*) [n])0)[1+n][0])) &gt;&gt; 1
);
</code></pre>

<p>完整代码如下</p>
<pre><code class="cpp">#include &lt;stdio.h&gt;
#include &lt;stdint.h&gt;

int rich(int n)
{
	return ( (int)( &amp;((uint8_t (*) [n])0)[1+n][0]) ) &gt;&gt; 1;
}

int main()
{
	printf(&quot;%d\n&quot;, rich(10));

	return 0;
}
</code></pre>


<hr/>
<div class="footer">
	Copyright &copy; xiaoxiyouran. All rights reserved.

</div>

</div> <!-- /container -->

<!---------------------------------------------------------------------------------------------------------------------------->

        </TD>
  </TR>
</TABLE>

<!-- 请注意，以下两个部分的代码执行是有顺序的，必须严格按照这个顺序来。另外，放在底部是为了优化界面，使加载速度更快 -->
<!-- 为了优化代码风格 -->
<script src="../../../../packages/js/jquery-1.9.1.min.js" ></script>
<script src="../../../../packages/js/bootstrap.min.js" ></script>
<script src="../../../../packages/js/highlight.min.js" ></script>
<script >hljs.initHighlightingOnLoad();</script>

<!-- 以下是为了生成文档的侧边栏 -->
<script type="text/javascript" src="../../../../packages/generate_header_sidebar/js/jquery-1.4.4.min.js"></script>
<script type="text/javascript" src="../../../../packages/generate_header_sidebar/js/jquery.ztree.core-3.5.js"></script>
<script type="text/javascript" src="../../../../packages/generate_header_sidebar/src/ztree_toc.js"></script>

<SCRIPT type="text/javascript" >
<!--
$(document).ready(function(){
  $('#tree').ztree_toc({
    is_auto_number : true,
    use_head_anchor: true
  });
});
//-->
</SCRIPT>

</body>
</html>
    